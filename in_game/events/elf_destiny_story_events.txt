namespace = elf_destiny_story

elf_destiny_story.99 = {
	title = ""
	desc = ""
	type = country_event

	trigger = {

	}

	hidden = yes

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

		if = {
			limit = {
				any_country = {
					is_ai = no
				}
			}

			debug_log = "elf_destiny_story.01 Player countries exist!"
		}
		else = {
			debug_log = "elf_destiny_story.01 Player countries DONT exist!"
		}

		every_country = {
			limit = {
				is_ai = no
			}
			debug_log = "elf_destiny_story.01 country reached"

			trigger_event_non_silently = {
				id = elf_destiny_story.1
				days = 2
			}	
		}
	}
	
	# option = {
	# 	# name = elf_destiny_story.1.a


	# 	# trigger_event_silently = {
	# 	# 	id = elf_destiny_story.2
	# 	# }	

    #     # unlock sponsor expedition character action
	# }
}


# What is an archeologist - Julia shows up
elf_destiny_story.1 = {
	type = country_event
	title = elf_destiny_story.1.title
	desc = elf_destiny_story.1.desc
	trigger = {

	}

	# illustration_tags = {
    #     10 = regular
    #     10 = interior
    # }

	image = "gfx/interface/illustrations/event/backgrounds/expedition.dds"

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

		# if = {
		# 	limit = {
		# 		any_country = {
		# 			is_ai = no
		# 		}
		# 	}

		# 	debug_log = "elf_destiny_story.1 Player countries exist!"
		# }
		# else = {
		# 	debug_log = "elf_destiny_story.1 Player countries DONT exist!"
		# }
	}
	
	option = {
		name = elf_destiny_story.1.a


		trigger_event_silently = {
			id = elf_destiny_story.11
		}
	}
}

elf_destiny_story.11 = {
	type = country_event
	title = elf_destiny_story.11.title
	desc = elf_destiny_story.11.desc
	trigger = {

	}

	# illustration_tags = {
    #     10 = regular
    #     10 = interior
    # }

	image = "gfx/interface/illustrations/event/backgrounds/expedition.dds"

	immediate = {
		character:julia_melwood = {
			save_scope_as = portrait_1
		}
	}
	
	option = {
		name = elf_destiny_story.11.a

		character:julia_melwood = {
			move_country = root
		}
		
		trigger_event_silently = {
			id = elf_destiny_story.2
		}	

        # unlock sponsor expedition character action
		set_variable = {
			name = expeditions_unlocked
			value = yes
		}
	}

	option = {
		name = elf_destiny_story.11.b
	}

}



# Julia returns with a chest, she opens it to reveal a amulet she found on the neck of a long dead elf emperor, touch it
elf_destiny_story.2 = {
	type = country_event
	title = elf_destiny_story.2.title
	desc = elf_destiny_story.2.desc
	trigger = {

	}

	hide_portraits = yes

	illustration_tags = {
        10 = regular
        10 = interior
    }

	image = "gfx/interface/illustrations/event/backgrounds/realm_lord_sigil.dds"

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

	}
	
	option = {
		name = elf_destiny_story.2.a

		trigger_event_silently = {
			id = elf_destiny_story.21
		}	

	}
}

elf_destiny_story.21 = {
	type = country_event
	title = elf_destiny_story.21.title
	desc = elf_destiny_story.21.desc
	trigger = {

	}

	hide_portraits = yes

	illustration_tags = {
        10 = regular
        10 = interior
    }

	image = "gfx/interface/illustrations/event/backgrounds/realm_lord_sigil_blinded.dds"

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

	}
	
	option = {
		name = elf_destiny_story.21.a

		trigger_event_silently = {
			id = elf_destiny_story.22
		}	

	}
}

elf_destiny_story.22 = {
	type = country_event
	title = elf_destiny_story.22.title
	desc = elf_destiny_story.22.desc
	trigger = {

	}

	hide_portraits = yes


	illustration_tags = {
        10 = regular
        10 = interior
    }

	image = "gfx/interface/illustrations/event/backgrounds/divine_spark.dds"

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

	}
	
	option = {
		name = elf_destiny_story.22.convert

		trigger_event_silently = {
			id = elf_destiny_story.23
		}

		change_culture = culture:elven_culture

		custom_tooltip = {
			text = all_characters_convert_to_elven
			every_character = {
				change_character_culture = culture:elven_culture
			}
		}

		custom_tooltip = {
			text = all_pops_convert_to_elven
			every_pop = {
				change_pop_culture = culture:elven_culture
			}
		}

		custom_tooltip = {
			text = all_locations_embrace_elven_institution
			every_province = {
				every_location_in_province = {
					change_institution_progress = {
						type = institution:elven
						value = 100
					}
				}
			}
		}

		save_scope_value_as = {
			name = took_elf_culture
			value = yes
		}

	}

	option = {
		name = elf_destiny_story.22.dontConvert

		custom_tooltip = {
			text = all_locations_embrace_elven_institution
			every_province = {
				every_location_in_province = {
					change_institution_progress = {
						type = institution:elven
						value = 100
					}
				}
			}
		}

		trigger_event_silently = {
			id = elf_destiny_story.23
		}	
	}
}

elf_destiny_story.23 = {
	type = country_event
	title = elf_destiny_story.23.title
	desc = elf_destiny_story.23.desc
	trigger = {

	}

	hide_portraits = yes


	illustration_tags = {
        10 = regular
        10 = interior
    }

	image = "gfx/interface/illustrations/event/backgrounds/realm_lord_sigil.dds"

	immediate = {
		every_character = {
			assign_race_trait = { trait = elf_tier_2 }
		}
	}
	
	option = {
		name = elf_destiny_story.23.a

		if = {
			limit = {
				exists = scope:took_elf_culture
			}
			trigger_event_silently = {
				id = elf_destiny_story.24
			}	
		}
		else = {
			trigger_event_silently = {
				id = elf_destiny_story.3
			}	
		}

	}
}

elf_destiny_story.24 = {
	type = country_event
	title = elf_destiny_story.24.title
	desc = elf_destiny_story.24.desc
	trigger = {

	}

	hide_portraits = yes


	illustration_tags = {
        10 = regular
        10 = interior
    }

	image = "gfx/interface/illustrations/event/backgrounds/realm_lord_sigil.dds"

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

	}
	
	option = {
		name = elf_destiny_story.24.a

		trigger_event_silently = {
			id = elf_destiny_story.3
		}
	}
}

elf_destiny_story.3 = {
	type = country_event
	title = elf_destiny_story.3.title
	desc = elf_destiny_story.3.desc
	trigger = {

	}

	hide_portraits = yes


	illustration_tags = {
        10 = regular
        10 = interior
    }

	image = "gfx/interface/illustrations/event/backgrounds/divine_spark.dds"

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }
		clear_saved_scope = julia
	}
	
	option = {
		name = elf_destiny_story.3.good

		trigger_event_silently = {
			id = elf_destiny_story.4
		}	
	}

	option = {
		name = elf_destiny_story.3.evil

		trigger_event_silently = {
			id = elf_destiny_story.4
		}	
	}
}


# visit from aeluran order
elf_destiny_story.4 = {
	type = country_event
	title = elf_destiny_story.4.title
	desc = elf_destiny_story.4.desc
	trigger = {

	}

	image = "gfx/interface/illustrations/event/backgrounds/aeluran_leaves.dds"

	hide_portraits = yes


	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }
		clear_saved_scope = julia


		# debug_log = "elf_destiny_story.4"
		# debug_log_scopes = yes

	}
	
	option = {
		name = elf_destiny_story.4.a

        trigger_event_silently = {
			id = elf_destiny_story.41
		}	
	}
}

elf_destiny_story.41 = {
	type = country_event
	title = elf_destiny_story.41.title
	desc = elf_destiny_story.41.desc
	trigger = {

	}

	image = "gfx/interface/illustrations/event/backgrounds/aeluran_leaves.dds"

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }
		religion:aeluran.religious_head.ruler = {
			save_scope_as = portrait_1
		}

	}
	
	option = {
		name = elf_destiny_story.41.a

        trigger_event_silently = {
			id = elf_destiny_story.42
		}	
	}
}


elf_destiny_story.42 = {
	type = country_event
	title = elf_destiny_story.42.title
	desc = elf_destiny_story.42.desc
	trigger = {

	}

	image = "gfx/interface/illustrations/event/backgrounds/aeluran_leaves.dds"

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }
		set_variable = {
			name = spoke_with_aelurans
			value = yes
		}

		# start_mission = {
		# 	mission = mission:restore_the_grand_portal_mission
		# }
	}
	
	option = {
		name = elf_destiny_story.42.a

        trigger_event_silently = {
			id = elf_destiny_story.43
		}	
	}
}

elf_destiny_story.43 = {
	type = country_event
	title = elf_destiny_story.43.title
	desc = elf_destiny_story.43.desc
	trigger = {

	}

	image = "gfx/interface/illustrations/event/backgrounds/aeluran_leaves.dds"

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

	}
	
	option = {
		name = elf_destiny_story.43.a

		change_religion = religion:aeluran
		custom_tooltip = {
			text = all_characters_convert_to_aeluran
			every_character = {
				change_character_religion = religion:aeluran
			}
		}
		custom_tooltip = {
			text = all_pops_convert_to_aeluran
			every_pop = {
				change_pop_religion = religion:aeluran
			}
		}

        # trigger_event_silently = {
		# 	id = elf_destiny_story.4
		# }	
	}

	option = {
		name = elf_destiny_story.43.b
	}
}

# Transport Portal
elf_destiny_story.5 = { # confirm?
	type = country_event
	title = elf_destiny_story.5.title
	desc = elf_destiny_story.5.desc
	trigger = {

	}

	hide_portraits = yes

	image = "gfx/interface/illustrations/event/backgrounds/transport_portal.dds"

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

	}
	
	option = {
		name = elf_destiny_story.5.a
		scope:old_location = {
			destroy_all_buildings_of_type = building_type:grand_portal_ruins
		}

		set_global_variable = {
			name = portal_transported
			value = yes
		}

		trigger_event_silently = {
			id = elf_destiny_story.51
			days = 10
		}

	}

	# option = {
	# 	name = elf_destiny_story.5.b
	# }
}

elf_destiny_story.51 = { # Portal ruins have arrived!
	type = country_event
	title = elf_destiny_story.51.title
	desc = elf_destiny_story.51.desc
	trigger = {

	}

	hide_portraits = yes

	image = "gfx/interface/illustrations/event/backgrounds/transport_portal.dds"

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }
		# scope:actor = {

		# }

	}
	
	option = {
		name = elf_destiny_story.51.a
		custom_tooltip = {
			text = grand_portal_ruins_built_in_capital_tooltip
			capital = {
				set_variable = grand_portal_eligible
				construct_building = {
					building_type = building_type:grand_portal_ruins
					cost_multiplier = 0
					cost_multiplier_reason = "grand_portal_cha_cha_cha"
					instant = yes	
				}
			}
		}

		# complete_mission_task = mission_task:mission_task_transport_the_portal_mission
	}
}

elf_destiny_story.52 = { # Start repairs?
	type = country_event
	title = elf_destiny_story.52.title
	desc = elf_destiny_story.52.desc
	trigger = {

	}

	hide_portraits = yes

	image = "gfx/interface/illustrations/event/backgrounds/portal_broken.dds"

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

	}
	
	option = {
		name = elf_destiny_story.52.a
		set_global_variable = {
			name = portal_restored
			value = yes
		}

		hidden_effect = {
			random_location_in_the_world = {
				limit = {
					has_building_with_at_least_one_level = grand_portal_ruins
				}

				destroy_all_buildings_of_type = building_type:grand_portal_ruins
			}
		}
		capital = {
			construct_building = {
				building_type = building_type:grand_portal
			}
		}
		trigger_event_silently = { # FOR TESTING
			id = elf_destiny_story.53
			days = 3
		}
	}

	# option = {
	# 	name = elf_destiny_story.52.b
	# }
}

elf_destiny_story.53 = { # Portal Restored!
	type = country_event
	title = elf_destiny_story.53.title
	desc = elf_destiny_story.53.desc
	trigger = {

	}

	hide_portraits = yes

	image = "gfx/interface/illustrations/event/backgrounds/portal_restored.dds"

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }
	}
	
	option = {
		name = elf_destiny_story.53.a

		# TODO:  Restorer of the Portal modifier, maybe put in the mission as a reward

		trigger_event_silently = {
			id = elf_destiny_story.54
		}

		# complete_mission_task = mission_task:mission_task_restore_the_grand_portal
	}
}

elf_destiny_story.54 = { # Thanks for Playing!
	type = country_event
	title = elf_destiny_story.54.title
	desc = elf_destiny_story.54.desc
	trigger = {

	}

	hide_portraits = yes

	image = "gfx/interface/illustrations/event/backgrounds/elf_destiny.dds"

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		# event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }
	}
	
	option = { # free blessing
		name = elf_destiny_story.54.a

		trigger = {
			has_all_blessings = no
		}

		trigger_event_non_silently = {
			id = ascension_events.2
		}
	}

	option = { # gold
		name = elf_destiny_story.54.b

		add_gold = {
			value = country_tax_base
			multiply = 25
		}
	}

	option = { # prestige and stability
		name = elf_destiny_story.54.c

		add_prestige = 100
		add_stability = 100
	}

	option = { # nothing
		name = elf_destiny_story.54.d
	}
}