assign_elf_racial_trait_effect = {
	debug_log = "assign_elf_racial_trait_effect"
	if = {
		limit = {
			inherited_elf_racial_score > 0
			inherited_elf_racial_score < 2
		}
		assign_racial_trait = { trait = elf_tier_1}
	}
	if = {
		limit = {
			inherited_elf_racial_score >= 2
			inherited_elf_racial_score < 3
		}
		assign_racial_trait = { trait = elf_tier_2}
	}
	if = {
		limit = {
			inherited_elf_racial_score >= 3
			inherited_elf_racial_score < 4
		}
		assign_racial_trait = { trait = elf_tier_3}
	}
	if = {
		limit = {
			inherited_elf_racial_score >= 4
			inherited_elf_racial_score < 5
		}
		assign_racial_trait = { trait = elf_tier_4}
	}
	if = {
		limit = {
			inherited_elf_racial_score >= 5
			inherited_elf_racial_score < 6
		}
		assign_racial_trait = { trait = elf_tier_5}
	}
	if = {
		limit = {
			inherited_elf_racial_score >= 6
			inherited_elf_racial_score < 7
		}
		assign_racial_trait = { trait = elf_tier_6}
	}
	if = {
		limit = {
			inherited_elf_racial_score >= 7
			inherited_elf_racial_score < 8
		}
		assign_racial_trait = { trait = elf_tier_7}
	}
	if = {
		limit = {
			inherited_elf_racial_score >= 8
			inherited_elf_racial_score < 9
		}
		assign_racial_trait = { trait = elf_tier_8}
	}
	if = {
		limit = {
			inherited_elf_racial_score >= 9
			inherited_elf_racial_score < 10
		}
		assign_racial_trait = { trait = elf_tier_9}
	}
	if = {
		limit = {
			inherited_elf_racial_score >= 10
			inherited_elf_racial_score < 11
		}
		assign_racial_trait = { trait = elf_tier_10}
	}
	if = {
		limit = {
			inherited_elf_racial_score >= 11
			inherited_elf_racial_score < 12
		}
		assign_racial_trait = { trait = elf_tier_11}
	}
	if = {
		limit = {
			inherited_elf_racial_score >= 12
		}
		assign_racial_trait = { trait = elf_tier_12}
	}
}

# increase_elf_race_level = {

# 	assign_racial_trait = { trait = elf_tier_1}
# }

assign_racial_trait = {
	add_character_modifier = {
		modifier = $trait$
		# mode = add_and_extend
	}

	set_variable = {
		name = character_race
		value = trait:$trait$
	}
}

remove_any_racial_trait = {
	if = { 
		limit = {has_racial_trait = { trait = elf_tier_1 }}
		remove_racial_trait = { trait = elf_tier_1}
	}
	if = { 
		limit = {has_racial_trait = { trait = elf_tier_2 }}
		remove_racial_trait = { trait = elf_tier_2}
	}
	if = { 
		limit = {has_racial_trait = { trait = elf_tier_3 }}
		remove_racial_trait = { trait = elf_tier_3}
	}
	if = { 
		limit = {has_racial_trait = { trait = elf_tier_4 }}
		remove_racial_trait = { trait = elf_tier_4}
	}
	if = { 
		limit = {has_racial_trait = { trait = elf_tier_5 }}
		remove_racial_trait = { trait = elf_tier_5}
	}
	if = { 
		limit = {has_racial_trait = { trait = elf_tier_6 }}
		remove_racial_trait = { trait = elf_tier_6}
	}
	if = { 
		limit = {has_racial_trait = { trait = elf_tier_7 }}
		remove_racial_trait = { trait = elf_tier_7}
	}
	if = { 
		limit = {has_racial_trait = { trait = elf_tier_8 }}
		remove_racial_trait = { trait = elf_tier_8}
	}
	if = { 
		limit = {has_racial_trait = { trait = elf_tier_8 }}
		remove_racial_trait = { trait = elf_tier_9}
	}
	if = { 
		limit = {has_racial_trait = { trait = elf_tier_10 }}
		remove_racial_trait = { trait = elf_tier_10}
	}
	if = { 
		limit = {has_racial_trait = { trait = elf_tier_11 }}
		remove_racial_trait = { trait = elf_tier_11}
	}
	if = { 
		limit = {has_racial_trait = { trait = elf_tier_12 }}
		remove_racial_trait = { trait = elf_tier_12}
	}
}


remove_racial_trait = {
	remove_character_modifier = $trait$
	remove_variable = character_race
}


assign_bloodline_traits_at_birth_effect = {
	either_parent_genetic_inheritance = { trait = royal_elf_valerith }
	either_parent_genetic_inheritance = { trait = royal_elf_serelion }
	either_parent_genetic_inheritance = { trait = royal_elf_gwynthorn }
	either_parent_genetic_inheritance = { trait = royal_elf_thundarael }
	either_parent_genetic_inheritance = { trait = royal_elf_daelurin }
	either_parent_genetic_inheritance = { trait = royal_elf_lormelis }
}

# If either parent has the trait, the child will inherit it.
either_parent_genetic_inheritance = {
	if = {
		limit = {
			OR = {
				scope:character.father = {
					has_genetic_trait = { trait = $trait$ }
				}
				scope:character.mother = {
					has_genetic_trait = { trait = $trait$ }
				}
			}
		}

		scope:character ?= {
			assign_genetic_trait = { trait = $trait$}
		}
	}
}

genetic_inheritance_effect = {
	leveled_trait_inheritance = {trait = beauty}
	leveled_trait_inheritance = {trait = intellect}
	leveled_trait_inheritance = {trait = physique}

	if = { # there isn't a level 4 upgraded beauty trait yet
		limit = {
			NOT = {
				has_genetic_trait = { trait = beauty_good_4 }
			}
		}
		upgraded_beauty_inheritance = yes
	}

	single_trait_inheritance = {
		trait = fecund
		single_parent_chance = 33
	}
	single_trait_inheritance = {
		trait = giant
		single_parent_chance = 33
	}
	pure_blood_inheritance = yes

	random = { # chance to be born with a genetic trait not inherited
		chance = born_with_uninherited_genetic_trait_chance
		use_fake_random_effect = { function_name = assign_random_genetic_trait }
	}
}

leveled_trait_inheritance = {
	set_variable = {
		name = trait_score
		value = inherited_$trait$_trait_score 
	}

	# Chance to reinforce genetic trait
	if = {
		limit = {
			var:trait_score > 0
		}

		random = {
			chance = 25
			change_variable = {
				name = trait_score
				add = 1 
			}
		}
	}

	if = {
		limit = {
			var:trait_score >= 4
			owner = {
				has_religious_aspect = religious_aspect:noble_husbandry
			}
		}

		assign_genetic_trait = { trait = $trait$_good_4}
	}
	else_if = {
		limit = {
			var:trait_score >= 3
		}

		assign_genetic_trait = { trait = $trait$_good_3}
	}
	else_if = {
		limit = {
			var:trait_score >= 2
		}

		assign_genetic_trait = { trait = $trait$_good_2}
	}
	else_if = {
		limit = {
			var:trait_score >= 1
		}

		assign_genetic_trait = { trait = $trait$_good_1}
	}
	else_if = {
		limit = {
			var:trait_score <= -1
		}

		assign_genetic_trait = { trait = $trait$_bad_1}
	}
	else_if = {
		limit = {
			var:trait_score <= -2
		}

		assign_genetic_trait = { trait = $trait$_bad_2}
	}
	else_if = {
		limit = {
			var:trait_score <= -3
		}

		assign_genetic_trait = { trait = $trait$_bad_3}
	}
}

single_trait_inheritance = {
	if = {
		limit = {
			AND = {
				scope:character.father = {
					has_genetic_trait = { trait = $trait$ }
				}
				scope:character.mother = {
					has_genetic_trait = { trait = $trait$ }
				}
			}
		}

		scope:character ?= {
			assign_genetic_trait = { trait = $trait$}
		}
	}
	else_if = {
		limit = {
			OR = {
				scope:character.father = {
					has_genetic_trait = { trait = $trait$ }
				}
				scope:character.mother = {
					has_genetic_trait = { trait = $trait$ }
				}
			}
		}

		random = {
			chance = $single_parent_chance$
			scope:character ?= {
				assign_genetic_trait = { trait = $trait$}
			}
		}
	}
}

# WHY DO WE NEED THIS ABOMINATION?
# Answer: random_list = {} and random = {} are actually not truly random,
# and in certain scenarios will return the exact same result over and over. This helps with that.
use_fake_random_effect = {
	switch = {
		trigger = global_var:semi_random_integer
		1 = { $function_name$ = yes }
		2 = { $function_name$ = yes }
		3 = { $function_name$ = yes }
		4 = { $function_name$ = yes }
		5 = { $function_name$ = yes }
		6 = { $function_name$ = yes }
		7 = { $function_name$ = yes }
		8 = { $function_name$ = yes }
		9 = { $function_name$ = yes }
		10 = { $function_name$ = yes }
		11 = { $function_name$ = yes }
		12 = { $function_name$ = yes }
		13 = { $function_name$ = yes }
		14 = { $function_name$ = yes }
		15 = { $function_name$ = yes }
		16 = { $function_name$ = yes }
		17 = { $function_name$ = yes }
		18 = { $function_name$ = yes }
		19 = { $function_name$ = yes }
		20 = { $function_name$ = yes }
		21 = { $function_name$ = yes }
		22 = { $function_name$ = yes }
		23 = { $function_name$ = yes }
		24 = { $function_name$ = yes }
		25 = { $function_name$ = yes }
		26 = { $function_name$ = yes }
		27 = { $function_name$ = yes }
		28 = { $function_name$ = yes }
		29 = { $function_name$ = yes }
		30 = { $function_name$ = yes }
		
		fallback = { $function_name$ = yes }
	}

	set_global_variable = {
		name = semi_random_integer
		value = {
			integer_range = { min = 1 max = 30 }
		}
	}
}

# Chance Character is born with new genetic trait regardless of parents
assign_random_genetic_trait = {
	debug_log = "ASSIGNING RANDOM GENETIC TRAIT"

	random_list = {
		4 = {
			# debug_log =  "Assign Beauty"
			assign_random_beauty_trait = yes
		}
		4 = {
			# debug_log =  "Assign Intellect"
			assign_random_intellect_trait = yes
		}
		4 = {
			# debug_log =  "Assign Physique"
			assign_random_physique_trait = yes
		}
		1 = {
			# debug_log =  "Assign Other"
			assign_random_other_trait = yes
		}
	}
}

assign_random_beauty_trait = {
	if = {
		limit = {
			beauty_trait_score = 0
		}
		debug_log = "beauty_trait_score = 0"
		random_list = {
			96 = { # Normal Beauty
				random_list = {
					3 = { # Beauty Bad 1
						assign_genetic_trait = { trait = beauty_bad_1}
					}
					2 = { # Beauty Bad 2
						assign_genetic_trait = { trait = beauty_bad_2}
					}
					1 = { # Beauty Bad 3
						assign_genetic_trait = { trait = beauty_bad_3}
					} 
					9 = { # Beauty Good 1
						assign_genetic_trait = { trait = beauty_good_1}
					} 
					6 = { # Beauty Good 2
						assign_genetic_trait = { trait = beauty_good_2}
					} 
					3 = { # Beauty Good 3
						assign_genetic_trait = { trait = beauty_good_3}
					}
				}
			}
			4 = { # Rare Beauty
				random_list = {
					6 = { # Unconventional Beauty Good 1
						assign_genetic_trait = { trait = unconventional_beauty_good_1}
					}
					4 = { # Unconventional Beauty Good 2
						assign_genetic_trait = { trait = unconventional_beauty_good_2}
					}
					2 = { # Unconventional Beauty Good 3
						assign_genetic_trait = { trait = unconventional_beauty_good_3}
					} 
					3 = { # Exotic Beauty Good 1
						assign_genetic_trait = { trait = exotic_beauty_good_1}
					} 
					2 = { # Exotic Beauty Good 2
						assign_genetic_trait = { trait = exotic_beauty_good_2}
					} 
					1 = { # Exotic Beauty Good 3
						assign_genetic_trait = { trait = exotic_beauty_good_3}
					}
				}
			}
		}
	}
	else = {
		debug_log = "Character already had beauty trait"
	}

}

assign_random_intellect_trait = {
	if = {
		limit = {
			intellect_trait_score = 0
		}
		debug_log = "intellect_trait_score = 0"
		random_list = {
			3 = { # Intellect Bad 1
				assign_genetic_trait = { trait = intellect_bad_1}
			}
			2 = { # Intellect Bad 2
				assign_genetic_trait = { trait = intellect_bad_2}
			}
			1 = { # Intellect Bad 3
				assign_genetic_trait = { trait = intellect_bad_3}
			} 
			9 = { # Intellect Good 1
				assign_genetic_trait = { trait = intellect_good_1}
			} 
			6 = { # Intellect Good 2
				assign_genetic_trait = { trait = intellect_good_2}
			} 
			3 = { # Intellect Good 3
				assign_genetic_trait = { trait = intellect_good_3}
			}
		}
	}
	else = {
		debug_log = "Character already had intellect trait"
	}
}

assign_random_physique_trait = {
	if = {
		limit = {
			physique_trait_score = 0
		}
		debug_log = "physique_trait_score = 0"
		random_list = {
			3 = { # Physique Bad 1
				assign_genetic_trait = { trait = physique_bad_1}
			}
			2 = { # Physique Bad 2
				assign_genetic_trait = { trait = physique_bad_2}
			}
			1 = { # Physique Bad 3
				assign_genetic_trait = { trait = physique_bad_3}
			} 
			9 = { # Physique Good 1
				assign_genetic_trait = { trait = physique_good_1}
			} 
			6 = { # Physique Good 2
				assign_genetic_trait = { trait = physique_good_2}
			} 
			3 = { # Physique Good 3
				assign_genetic_trait = { trait = physique_good_3}
			}
		}
	}
	else = {
		debug_log = "Character already had physique trait"
	}
}

assign_random_other_trait = {
	if = {
		limit = {
			NOR = {
				has_genetic_trait = { trait = fecund }
				has_genetic_trait = { trait = giant }
			}
		}
		debug_log = "No 'other' genetic traits"
		random_list = {
			2 = { # Fecund
				assign_genetic_trait = { trait = fecund}
			}
			2 = { # Giant
				assign_genetic_trait = { trait = giant}
			}
		}
	}
	else = {
		debug_log = "Character already an `other` trait"
	}
}

pure_blood_inheritance = {
	single_trait_inheritance = {
		trait = pure_blooded
		single_parent_chance = 50
	}

	if = {
		limit = {
			NOT = { has_character_modifier = pure_blooded }
			OR = {
				scope:character ?= {
					AND = {
						exists = father
						exists = mother
						father = {has_dynasty = yes}
						mother = {has_dynasty = yes}
						father.dynasty = mother.dynasty
					}
				}
				scope:character ?= {
					AND = {
						exists = father
						exists = mother
						father = {
							is_close_relative = scope:character.mother
						}
					}
				}
			}
		}

		random = {
			chance = 35
			scope:character ?= {
				assign_genetic_trait = { trait = pure_blooded}
			}
		}
	}
}

### Unconventional and Exotic beauty traits ###
upgraded_beauty_inheritance = {

	if = { # First we will see if the child will inherit from their parents
		limit = {
			scope:character ?= {
				OR = {
					has_genetic_trait = { trait = beauty_good_1 }
					has_genetic_trait = { trait = beauty_good_2 }
					has_genetic_trait = { trait = beauty_good_3 }
				}
			}
		}
		inherit_upgraded_beauty = { beauty_type = unconventional }
		inherit_upgraded_beauty = { beauty_type = exotic }
	}

	if = { # they still have a normal beauty chance, so they failed to inherit, random small chance to upgrade
		limit = {
			scope:character ?= {
				OR = {
					has_genetic_trait = { trait = beauty_good_1 }
					has_genetic_trait = { trait = beauty_good_2 }
					has_genetic_trait = { trait = beauty_good_3 }
				}
			}
		}
		random_list = {
			1 = {
				modifier = { # Beguiling Nature greatly increases odds 
					scope:character ?= {
						owner = {
							has_religious_aspect = religious_aspect:beguiling_nature
						}
					}
					add = 49
				}

				random_list = {
					2 = { # Unconventional
						upgrade_beauty_type = { new_beauty_type = unconventional }
					} 
					1 = { # Exotic
						upgrade_beauty_type = { new_beauty_type = exotic }
					}
					3 = {} # used to make odds even worse
				}
			}
			99 = {} # nothing happens
		}
	}
	else = {
		# extremely small chance to gain a random unconventional or exotic beauty trait without inheriting it
		random = {
			chance = 1
			modifier = { # Beguiling Nature greatly increases odds 
				scope:character ?= {
					owner = {
						has_religious_aspect = religious_aspect:beguiling_nature
					}
				}
				add = 10
			}

			scope:character ?= {
				random_list = {
					4 = { # Unconventional Beauty Good 1
						assign_genetic_trait = { trait = unconventional_beauty_good_1}
					} 
					3 = { # Unconventional Beauty Good 2
						assign_genetic_trait = { trait = unconventional_beauty_good_2}
					} 
					2 = { # Unconventional Beauty Good 3
						assign_genetic_trait = { trait = unconventional_beauty_good_3}
					} 
					3 = { # Exotic Beauty Good 1
						assign_genetic_trait = { trait = exotic_beauty_good_1}
					} 
					2 = { # Exotic Beauty Good 2
						assign_genetic_trait = { trait = exotic_beauty_good_2}
					} 
					1 = { # Exotic Beauty Good 3
						assign_genetic_trait = { trait = exotic_beauty_good_3}
					}
					5 = {} # used to make odds even worse
				}
			}
		}
	}

  # small cahnce to upgrade unconventioanl beauty trait
}

inherit_upgraded_beauty = {
	if = { # if both parent had a rare beauty trait, guaranteed to improve child's beauty trait
		limit = {
			AND = {
				scope:character.father = {
					OR = {
						has_genetic_trait = { trait = $beauty_type$_beauty_good_1 }
						has_genetic_trait = { trait = $beauty_type$_beauty_good_2 }
						has_genetic_trait = { trait = $beauty_type$_beauty_good_3 }
					}
				}
				scope:character.mother = {
					OR = {
						has_genetic_trait = { trait = $beauty_type$_beauty_good_1 }
						has_genetic_trait = { trait = $beauty_type$_beauty_good_2 }
						has_genetic_trait = { trait = $beauty_type$_beauty_good_3 }
					}
				}
			}
		}

		scope:character ?= {
			upgrade_beauty_type = { new_beauty_type = $beauty_type$ }
		}
	}
	else_if = { # if one parent had a rare beauty trait, good chance to improve child's beauty trait
		limit = {
			OR = {
				scope:character.father = {
					OR = {
						has_genetic_trait = { trait = $beauty_type$_beauty_good_1 }
						has_genetic_trait = { trait = $beauty_type$_beauty_good_2 }
						has_genetic_trait = { trait = $beauty_type$_beauty_good_3 }
					}
				}
				scope:character.mother = {
					OR = {
						has_genetic_trait = { trait = $beauty_type$_beauty_good_1 }
						has_genetic_trait = { trait = $beauty_type$_beauty_good_2 }
						has_genetic_trait = { trait = $beauty_type$_beauty_good_3 }
					}
				}
			}
		}

		random = {
			chance = 50
			scope:character ?= {
				upgrade_beauty_type = { new_beauty_type = $beauty_type$ }
			}
		}
	}

}

upgrade_beauty_type = {
	if = {
		limit = {
			has_genetic_trait = { trait = beauty_good_1 }
		}
		remove_genetic_trait = { trait = beauty_good_1 }
		assign_genetic_trait = { trait = $new_beauty_type$_beauty_good_1 }
	}
	else_if = {
		limit = {
			has_genetic_trait = { trait = beauty_good_2 }
		}
		remove_genetic_trait = { trait = beauty_good_2 }
		assign_genetic_trait = { trait = $new_beauty_type$_beauty_good_2 }
	}
	else_if = {
		limit = {
			has_genetic_trait = { trait = beauty_good_3 }
		}
		remove_genetic_trait = { trait = beauty_good_3 }
		assign_genetic_trait = { trait = $new_beauty_type$_beauty_good_3 }
	}
}

assign_genetic_trait = {
	add_character_modifier = {
		modifier = $trait$
		# mode = add_and_extend
	}

	add_to_variable_list = {
		name = genetic_traits
		target = trait:$trait$
	}
}

remove_genetic_trait = {
	remove_character_modifier = $trait$

	remove_list_variable = {
		name = genetic_traits
		target = trait:$trait$
	}
}

remove_all_genetic_traits_of_type = {
	hidden_effect = {
		if = { 
			limit = { has_genetic_trait = {trait = $trait_type$_good_1} }
			remove_genetic_trait = { trait = $trait_type$_good_1 }
		}
		if = { 
			limit = { has_genetic_trait = {trait = $trait_type$_good_2} }
			remove_genetic_trait = { trait = $trait_type$_good_2 }
		}
		if = { 
			limit = { has_genetic_trait = {trait = $trait_type$_good_3} }
			remove_genetic_trait = { trait = $trait_type$_good_3 }
		}
		if = { 
			limit = { has_genetic_trait = {trait = $trait_type$_good_4} }
			remove_genetic_trait = { trait = $trait_type$_good_4 }
		}
		if = { 
			limit = { has_genetic_trait ={trait = $trait_type$_bad_1} }
			remove_genetic_trait = { trait = $trait_type$_bad_1 }
		}
		if = { 
			limit = { has_genetic_trait = {trait = $trait_type$_bad_2} }
			remove_genetic_trait = { trait = $trait_type$_bad_2 }
		}
		if = { 
			limit = { has_genetic_trait = {trait = $trait_type$_bad_3} }
			remove_genetic_trait = { trait = $trait_type$_bad_3 }
		}

		# Unconventional/Exotic
		if = { 
			limit = { flag:$trait_type$ = flag:beauty }
			
			if = { limit = { has_genetic_trait = {trait = unconventional_$trait_type$_good_1} }
				remove_genetic_trait = { trait = unconventional_$trait_type$_good_1 }
			}
			if = { limit = { has_genetic_trait = {trait = unconventional_$trait_type$_good_2} }
				remove_genetic_trait = { trait = unconventional_$trait_type$_good_2 }
			}
			if = { limit = { has_genetic_trait = {trait = unconventional_$trait_type$_good_3} }
				remove_genetic_trait = { trait = unconventional_$trait_type$_good_3 }
			}
			if = { limit = { has_genetic_trait = {trait = exotic_$trait_type$_good_1} }
				remove_genetic_trait = { trait = exotic_$trait_type$_good_1 }
			}
			if = { limit = { has_genetic_trait = {trait = exotic_$trait_type$_good_2} }
				remove_genetic_trait = { trait = exotic_$trait_type$_good_2 }
			}
			if = { limit = { has_genetic_trait ={trait =  exotic_$trait_type$_good_3} }
				remove_genetic_trait = { trait = exotic_$trait_type$_good_3 }
			}
		}
	}
}

give_genetic_traits_to_starter_characters_effect = {
	# needed for GUI stuff
	set_global_variable = {
		name = human_trait
		value = trait:human
	}

	every_country = {
		every_character = {
			assign_any_missing_genetic_traits = yes
			give_starter_elf_trait = yes

			random = { # chance to start with a genetic trait
				chance = starting_characters_random_genetic_trait_spawn_chance_1
				use_fake_random_effect = { function_name = assign_random_genetic_trait }
			}
			random = { # even rarer chance to start with a second one
				chance = starting_characters_random_genetic_trait_spawn_chance_2
				use_fake_random_effect = { function_name = assign_random_genetic_trait }
			}
			# Note: Keep in mind these two combined make the actual odds of getting at least one trait higher than just the first %
		}
	}
}

give_starter_elf_trait = {
	if = {
		limit = {
			religion = religion:aeluran
			is_any_elf_type = no
		}

		assign_racial_trait = { trait = elf_tier_2 }
	}
}

# Used to give Setup characters traits that correspond to their character modifiers
assign_any_missing_genetic_traits = {
	assign_racial_trait_from_modifier = { trait = elf_tier_1 }
	assign_racial_trait_from_modifier = { trait = elf_tier_2 }
	assign_racial_trait_from_modifier = { trait = elf_tier_3 }
	assign_racial_trait_from_modifier = { trait = elf_tier_4 }
	assign_racial_trait_from_modifier = { trait = elf_tier_5 }
	assign_racial_trait_from_modifier = { trait = elf_tier_6 }
	assign_racial_trait_from_modifier = { trait = elf_tier_7 }
	assign_racial_trait_from_modifier = { trait = elf_tier_8 }
	assign_racial_trait_from_modifier = { trait = elf_tier_9 }
	assign_racial_trait_from_modifier = { trait = elf_tier_10 }
	assign_racial_trait_from_modifier = { trait = elf_tier_11 }
	assign_racial_trait_from_modifier = { trait = elf_tier_12 }

	assign_genetic_trait_from_modifier = { trait = royal_elf_valerith }
	assign_genetic_trait_from_modifier = { trait = royal_elf_serelion }
	assign_genetic_trait_from_modifier = { trait = royal_elf_gwynthorn }
	assign_genetic_trait_from_modifier = { trait = royal_elf_thundarael }
	assign_genetic_trait_from_modifier = { trait = royal_elf_daelurin }
	assign_genetic_trait_from_modifier = { trait = royal_elf_lormelis }

	assign_genetic_trait_from_modifier = { trait = beauty_bad_1 }
	assign_genetic_trait_from_modifier = { trait = beauty_bad_2 }
	assign_genetic_trait_from_modifier = { trait = beauty_bad_3 }
	assign_genetic_trait_from_modifier = { trait = beauty_good_1 }
	assign_genetic_trait_from_modifier = { trait = beauty_good_2 }
	assign_genetic_trait_from_modifier = { trait = beauty_good_3 }
	assign_genetic_trait_from_modifier = { trait = beauty_good_4 }
	assign_genetic_trait_from_modifier = { trait = unconventional_beauty_good_1 }
	assign_genetic_trait_from_modifier = { trait = unconventional_beauty_good_2 }
	assign_genetic_trait_from_modifier = { trait = unconventional_beauty_good_3 }
	assign_genetic_trait_from_modifier = { trait = exotic_beauty_good_1 }
	assign_genetic_trait_from_modifier = { trait = exotic_beauty_good_2 }
	assign_genetic_trait_from_modifier = { trait = exotic_beauty_good_3 }
	assign_genetic_trait_from_modifier = { trait = intellect_bad_1 }
	assign_genetic_trait_from_modifier = { trait = intellect_bad_2 }
	assign_genetic_trait_from_modifier = { trait = intellect_bad_3 }
	assign_genetic_trait_from_modifier = { trait = intellect_good_1 }
	assign_genetic_trait_from_modifier = { trait = intellect_good_2 }
	assign_genetic_trait_from_modifier = { trait = intellect_good_3 }
	assign_genetic_trait_from_modifier = { trait = intellect_good_4 }
	assign_genetic_trait_from_modifier = { trait = physique_bad_1 }
	assign_genetic_trait_from_modifier = { trait = physique_bad_2 }
	assign_genetic_trait_from_modifier = { trait = physique_bad_3 }
	assign_genetic_trait_from_modifier = { trait = physique_good_1 }
	assign_genetic_trait_from_modifier = { trait = physique_good_2 }
	assign_genetic_trait_from_modifier = { trait = physique_good_3 }
	assign_genetic_trait_from_modifier = { trait = physique_good_4 }
	assign_genetic_trait_from_modifier = { trait = pure_blooded }
	assign_genetic_trait_from_modifier = { trait = fecund }
	assign_genetic_trait_from_modifier = { trait = giant }
}

assign_genetic_trait_from_modifier = {
	if = {
		limit = {
			has_character_modifier = $trait$
			NOT = {
				is_target_in_variable_list = {
					name = genetic_traits
					target = trait:$trait$
				}
			}
		}

		add_to_variable_list = {
			name = genetic_traits
			target = trait:$trait$
		}
	}
}

assign_racial_trait_from_modifier = {
	if = {
		limit = {
			has_character_modifier = $trait$
			OR = {
				NOT = { has_variable = character_race }
				NOT = { var:character_race = trait:$trait$ }
			}
		}

		set_variable = {
			name = character_race
			value = trait:$trait$
		}
	}
}


ascension_effect = {
	if = {
		limit = { is_any_elf_type = no }
		assign_racial_trait = { trait = elf_tier_1}
	}
	else_if = {
		limit = { has_racial_trait = { trait = elf_tier_1 } }
		upgrade_elf_racial_trait = {
			old_level = 1
			new_level = 2
		}
	}
	else_if = {
		limit = { has_racial_trait = { trait = elf_tier_2 } }
		upgrade_elf_racial_trait = {
			old_level = 2
			new_level = 3
		}
	}
	else_if = {
		limit = { has_racial_trait = { trait = elf_tier_3 } }
		upgrade_elf_racial_trait = {
			old_level = 3
			new_level = 4
		}
	}
	else_if = {
		limit = { has_racial_trait = { trait = elf_tier_4 } }
		upgrade_elf_racial_trait = {
			old_level = 4
			new_level = 5
		}
	}
	else_if = {
		limit = { has_racial_trait = { trait = elf_tier_5 } }
		upgrade_elf_racial_trait = {
			old_level = 5
			new_level = 6
		}
	}
	else_if = {
		limit = { has_racial_trait = { trait = elf_tier_6 } }
		upgrade_elf_racial_trait = {
			old_level = 6
			new_level = 7
		}
	}
	else_if = {
		limit = { has_racial_trait = { trait = elf_tier_7 } }
		upgrade_elf_racial_trait = {
			old_level = 7
			new_level = 8
		}
	}
	else_if = {
		limit = { has_racial_trait = { trait = elf_tier_8 } }
		upgrade_elf_racial_trait = {
			old_level = 8
			new_level = 9
		}
	}
	else_if = {
		limit = { has_racial_trait = { trait = elf_tier_9 } }
		upgrade_elf_racial_trait = {
			old_level = 9
			new_level = 10
		}
	}
	else_if = {
		limit = { has_racial_trait = { trait = elf_tier_10 } }
		upgrade_elf_racial_trait = {
			old_level = 10
			new_level = 11
		}
	}
	else_if = {
		limit = { has_racial_trait = { trait = elf_tier_11 } }
		upgrade_elf_racial_trait = {
			old_level = 11
			new_level = 12
		}
	}
}

upgrade_elf_racial_trait = {
	remove_racial_trait = { trait = elf_tier_$old_level$}
	assign_racial_trait = { trait = elf_tier_$new_level$}
}


handle_created_character_race_effect = {
	if = {
		limit = {
			culture = { has_culture_group = culture_group:elven_culture_group}
			is_any_elf_type = no
		}

		debug_log = "handle_created_character_race_effect"
		debug_log_scopes = yes
		assign_racial_trait = { trait = elf_tier_2}
	}
}