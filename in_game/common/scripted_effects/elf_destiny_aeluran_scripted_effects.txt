daughters_sent_to_become_aeluran_sisters_effect = {
	every_character = {
		limit = {
			is_female = yes
			character_age >= 3
			character_age < 7
			# NOT = {
			# 	has_variable = refused_aeluran_training
			# }
		}

		save_scope_as = new_sister

		set_variable = {
			name = country_of_origin
			value = owner
		}

		set_child_education = child_education:aeluran_education

		if = {
			limit = {
				owner = { is_ai = no }
			}

			owner = {
				trigger_event_non_silently = {
					id = aeluran_events.4 
				}
			}
		}

		move_country = c:DWD
	}
}

daughters_return_as_aeluran_sisters_effect = {
	every_character = {
		limit = {
			is_female = yes
			is_adult = yes
			has_variable = country_of_origin
			NOT = {
				has_trait = aeluran_sister
			}
		}
		save_scope_as = new_sister

		add_trait = trait:aeluran_sister

		move_country = var:country_of_origin
		remove_variable = country_of_origin

		if = {
			limit = {
				owner = { is_ai = no}
			}

			owner = {
				trigger_event_silently = {
					id = aeluran_events.41
				}
			}
		}
	}
}


create_new_aeluran_advisor = {
	create_character = {
		age = {18 30}
		female = yes
	
		religion = religion:aeluran
		culture = root.culture
		estate = estate_type:clergy_estate
	
		# TODO: could have some privilege increase the stats of advisors
		adm = {
			integer_range = {
				min = {
					value = 50
				}
				max = {
					value = 100
				}
			}
		}
		dip = {
			integer_range = {
				min = {
					value = 50
				}
				max = {
					value = 100
				}
			}
		}
		mil = {
			integer_range = {
				min = {
					value = 50
				}
				max = {
					value = 100
				}
			}
		}
	
		add_trait = trait:aeluran_sister
		
		save_scope_as = aeluran_advisor
		set_variable = aeluran_advisor
	}
}

create_new_aeluran_matron_fallback = {
	c:DWD = {
		create_character = {
			age = {25 40}
			female = yes
		
			religion = religion:aeluran
			culture = culture:elven_culture
			estate = estate_type:clergy_estate
		
			adm = {
				integer_range = {
					min = {
						value = 50
					}
					max = {
						value = 100
					}
				}
			}
			dip = {
				integer_range = {
					min = {
						value = 50
					}
					max = {
						value = 100
					}
				}
			}
			mil = {
				integer_range = {
					min = {
						value = 50
					}
					max = {
						value = 100
					}
				}
			}
		
			add_trait = trait:aeluran_matron
			
			save_scope_as = new_matron
		}
	}
}

create_bloodline_orphan_effect = {
	random_list = {
		50 = {
			create_bloodline_orphan = {
				is_female = yes
				culture = $culture$
				blood = $blood$
			}
		}
		50 = {
			create_bloodline_orphan = {
				is_female = no
				culture = $culture$
				blood = $blood$
			}
		}
	}

	scope:orphan = {
		assign_genetic_trait = { trait = intellect_good_2 }
	}
}

create_bloodline_orphan= {
	create_character = {
		age = {5 8}
		female = $is_female$
		religion = religion:aeluran
		culture = culture:$culture$
		estate = estate_type:calaquendi_estate
	
		adm = {
			integer_range = {
				min = {
					value = 50
				}
				max = {
					value = 100
				}
			}
		}
		dip = {
			integer_range = {
				min = {
					value = 50
				}
				max = {
					value = 100
				}
			}
		}
		mil = {
			integer_range = {
				min = {
					value = 50
				}
				max = {
					value = 100
				}
			}
		}

		add_trait = trait:child_prodigy
	
		assign_genetic_trait = { trait = royal_elf_$blood$}
		
		save_scope_as = orphan
	}
}


create_bloodline_family_effect = {
	create_character = {
		age = {35 50}
	
		religion = religion:aeluran
		culture = culture:$culture$
		estate = estate_type:calaquendi_estate
	
		adm = {
			integer_range = {
				min = {
					value = 33
				}
				max = {
					value = 85
				}
			}
		}
		dip = {
			integer_range = {
				min = {
					value = 33
				}
				max = {
					value = 85
				}
			}
		}
		mil = {
			integer_range = {
				min = {
					value = 33
				}
				max = {
					value = 85
				}
			}
		}

		assign_genetic_trait = { trait = royal_elf_$blood$}
				
		save_scope_as = father_lord
	}

	create_character = {
		age = {29 35}
		female = yes
		religion = religion:aeluran
		culture = culture:$culture$
		estate = estate_type:calaquendi_estate
		dynasty = scope:father_lord.dynasty
	
		adm = {
			integer_range = {
				min = {
					value = 33
				}
				max = {
					value = 85
				}
			}
		}
		dip = {
			integer_range = {
				min = {
					value = 33
				}
				max = {
					value = 85
				}
			}
		}
		mil = {
			integer_range = {
				min = {
					value = 33
				}
				max = {
					value = 85
				}
			}
		}
	
		add_trait = trait:aeluran_sister

		assign_genetic_trait = { trait = royal_elf_$blood$}

		marry_character = scope:father_lord
		save_scope_as = mother
	}

	# scope:father_lord = { found_dynasty = random }
	# scope:mother = {
	# 	change_dynasty = scope:father.dynasty
	# }

	create_character = {
		age = {12 17}
		female = yes
		religion = religion:aeluran
		culture = culture:$culture$
		estate = estate_type:calaquendi_estate
		father = scope:father_lord
		mother = scope:mother
	
		adm = {
			integer_range = {
				min = {
					value = 33
				}
				max = {
					value = 85
				}
			}
		}
		dip = {
			integer_range = {
				min = {
					value = 33
				}
				max = {
					value = 85
				}
			}
		}
		mil = {
			integer_range = {
				min = {
					value = 33
				}
				max = {
					value = 85
				}
			}
		}

		assign_genetic_trait = { trait = royal_elf_$blood$}
	
		# add_trait = trait:aeluran_sister
		
		save_scope_as = older_daughter
	}

	create_character = {
		age = {5 9}
		religion = religion:aeluran
		culture = culture:$culture$
		estate = estate_type:calaquendi_estate
		father = scope:father_lord
		mother = scope:mother
	
		adm = {
			integer_range = {
				min = {
					value = 33
				}
				max = {
					value = 85
				}
			}
		}
		dip = {
			integer_range = {
				min = {
					value = 33
				}
				max = {
					value = 85
				}
			}
		}
		mil = {
			integer_range = {
				min = {
					value = 33
				}
				max = {
					value = 85
				}
			}
		}
	
		assign_genetic_trait = { trait = royal_elf_$blood$}
		
		save_scope_as = younger_son
	}
}


assign_new_aeluran_advisor = {

	# hidden_effect = {
		if = {
			limit = {
				NOT = {
					exists = scope:aeluran_advisor
				}
			}
			create_new_aeluran_advisor = yes
		}
	# }

	custom_tooltip = {
		text = aeluran_advisor_joins_realm

		scope:aeluran_advisor = {
			move_country = root
		}
	}

	custom_tooltip = {
		text = aeluran_advisor_joins_and_become_head_of_cabinet
		if = {
			limit = {
				exists = scope:aeluran_advisor
			}
			random_cabinet = {
				add_to_cabinet = scope:aeluran_advisor
			}
			
			promote_to_head_of_cabinet_effect = {
				target = scope:aeluran_advisor
			}
		}
	}
	
}


aeluran_succession_effect = {
	debug_log = "aeluran_succession_effect"
	if = {
		limit = {
			scope:target = {
				has_trait = aeluran_matron
			}
		}
		debug_log = "aeluran_succession_effect aeluran_matron"
		remove_list_global_variable = { name = aeluran_matrons target = scope:target }
		promote_random_sister_to_matron_effect = yes
	}
	if = {
		limit = {
			scope:target = {
				has_trait = aeluran_matriarch
			}
		}
		debug_log = "aeluran_succession_effect aeluran_matriarch"
		promote_random_matron_to_matriarch_effect = yes
	}
}

promote_random_sister_to_matron_effect = {
	debug_log = "promote_random_sister_to_matron_effect"

	random_country = {
		limit = {
			any_character = {
				has_trait = aeluran_sister
			}
		}
		random_character = {
			limit = {
				has_trait = aeluran_sister
			}
			save_scope_as = new_matron
		}
	}

	if = {
		limit = {
			NOT = {
				exists = scope:new_matron
			}
		}
		debug_log = "promote_random_sister_to_matron_effect fallback"

		create_new_aeluran_matron_fallback = yes
	}
	else = {
		scope:new_matron = {
			remove_trait = trait:aeluran_sister
			add_trait = trait:aeluran_matron
		}
	}

	debug_log = "promote_random_sister_to_matron_effect matron selected"
	debug_log_scopes = yes

	if = {
		limit = {
			scope:new_matron.owner = {
				is_ai = no
			}
		}

		scope:new_matron.owner = {
			trigger_event_non_silently = {
				id = aeluran_events.2 
			}
		}
	}

	add_to_global_variable_list = {
		name = aeluran_matrons
		target = scope:new_matron
	}
}

promote_random_matron_to_matriarch_effect = {
	random_in_global_list = {
		variable = aeluran_matrons
		save_scope_as = new_matriarch
	}

	scope:new_matriarch = {
		remove_trait = trait:aeluran_matron
		add_trait = trait:aeluran_matriarch
	}

	c:DWD = { set_new_ruler_no_update = scope:new_matriarch }

	remove_list_global_variable = { name = aeluran_matrons target = scope:new_matriarch }

	promote_random_sister_to_matron_effect = yes

	every_country = {
		limit = {
			is_ai = no
			religion = religion:aeluran
			NOT = {
				scope:new_matriarch.owner = this
			}
		}

		trigger_event_non_silently = {
			id = aeluran_events.3
		}
	}

	if = {
		limit = {
			scope:new_matriarch = {
				owner = {
					is_ai = no
				}
			}
		}

		scope:new_matriarch = {
			owner = {
				trigger_event_non_silently = {
					id = aeluran_events.31
				}
			}
		}
	}
}