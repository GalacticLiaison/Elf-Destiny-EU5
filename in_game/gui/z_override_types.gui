# template trait_item {
# 	tooltipwidget = { using = Trait_tooltip	}

# 	icon = {
# 		allow_outside = yes
# 		block "trait_item_size" {
# 			size = { 40 40 }
# 		}
		
# 		parentanchor = center
# 		# gfx/interface/icons/traits/blue_frame.dds
# 		texture = "[GetTraitBackground(Trait.Self)]"
# 		# glow = {
# 		# 	name = "drop_shadow"
# 		# 	glow_radius = 3
# 		# 	color = {0.0 0.0 0.0 1.0}
# 		# 	alpha = 0.4
# 		# }

# 		# Trait.GetFlavor.GetName

# 		glow = {
# 			# visible = "[EqualTo_string(Trait.GetFlavor.GetName, Localize('elf_bloodline'))]"
# 			visible = "[EqualTo_string(Trait.GetFlavor.GetName, 'elf_bloodline')]"

# 			name = "glowing"
# 			glow_radius = 9
# 			color = { 0.9 0.9 0.6 1 }
# 			alpha = 0.4
# 		}
# 		using = Animation_Glow_Pulse
# 	}

# 	icon = {
# 		allow_outside = yes
# 		block "trait_item_size" {
# 			size = { 40 40 }
# 		}

# 		parentanchor = center
# 		texture = "[GetTraitIcon(Trait.Self)]"
# 	}

# }

template Animation_Glow_Pulse
{
    state = {
        trigger_on_create = yes

        name = max_glow
        next = min_glow
        duration = 1.5
        using = Animation_Curve_Default

        glow_alpha = 0.8
    }

    state = {
        name = min_glow
        next = max_glow
        duration = 1.6
        using = Animation_Curve_Default

        glow_alpha = 0.4
    }
}


types override_types {
	type row_building_card = widget {
		block "row_building_card_frame_size" {
			size = { 100% 100% }
			parentanchor = center
			position = {0 0}
		}
		
		background = {
			using = bg_round_corners_alt_texture
			margin = {-1 0}
			modify_texture = {
				color = "[LocationBuildingItem.GetBuilding.GetType.GetPopType.GetColor]"
				# blend_mode = multiply
				alpha = 0.8
			}
			modify_texture = {
				using = overlay_cloth_texture
				blend_mode = overlay
				alpha = 0.1
			}
		}

		using = bg_tile_shadow		
		using = bg_cabinet_card_frame
		blockoverride "cabinet_card_shadow" {
			margin_bottom = 2
			margin_top = 0
			margin_right = 2
		}
		blockoverride "cabinet_card_frame" {
			margin_bottom = 1
			margin_top = 1
			margin_right = 1
		}

		vbox = {
			spacing = 1
			widget = {
				using = layoutpolicy_expanding
				vbox = {
					block "margin_size" {
						margin_top = 23
					}	
					widget = {
						layoutpolicy_horizontal = expanding
						block "number_size" {
							size = { -1 14 }
						}
						using = bg_text_mask_container_brown
						hbox = {
							text_single = {
								maximumsize = { 30 14 }
								fontsize = 13
								align = center
								visible = "[And3(LocationBuildingItem.IsBuilding, Not(LocationBuildingItem.GetBuilding.IsUnderConstruction), Not(And(LocationBuildingItem.GetBuilding.CanPlayerUpgrade, LocationBuildingItem.GetBuilding.IsPlayerUpgrading)))]"
								text = "[LocationBuildingItem.GetLevel]"
							}
							text_single = {
								maximumsize = { 30 14 }
								fontsize = 13
								align = center
								visible = "[And4(LocationBuildingItem.IsBuilding, Not(LocationBuildingItem.GetBuilding.IsUnderConstruction), LocationBuildingItem.GetBuilding.CanPlayerUpgrade, LocationBuildingItem.GetBuilding.IsPlayerUpgrading)]"
								raw_text = "[LocationBuildingItem.GetLevel] #G -[LocationBuildingItem.GetBuilding.GetLevelsUnderUpgrade|0]#!"
							}
							text_single = {
								maximumsize = { 30 14 }
								fontsize = 13
								align = center
								visible = "[And(LocationBuildingItem.IsBuilding, LocationBuildingItem.GetBuilding.IsUnderConstruction)]"
								raw_text = "[LocationBuildingItem.GetLevel] [LocationBuildingItem.GetBuilding.GetLevelsUnderConstruction|0+=]"
							}
						}
					}
				}

				card_header_button_04 = {
					visible = "[And3(Not(LocationBuildingItem.GetBuilding.GetType.IsProducing), LocationBuildingItem.IsPlayerBuilding, Not(LocationBuildingItem.GetBuilding.GetType.OnlyEstatesCanBuild))]"
					size = { 100% 100% }
					ignore_layout = yes
					action_tooltip = {
						click_type = left
						click_mode = single
						title = "OPEN_PROD_METHOD_BUILDING_ITEM_LOCATION"
						enabled = "[LocationBuildingItem.IsPlayerBuilding]"
						on_action = "[LocationBuildingItem.OpenBuildingView]"
					}
					action_tooltip = {
						click_type = right
						click_mode = single
						title = "BUILD_BUILDING_FROM_LOCATION"
						on_action = "[SelectLocationToBuildDefault(LocationBuildingItem.GetBuilding.GetType)]"
					}
					enabled = "[LocationBuildingItem.IsPlayerBuilding]"

					datacontext = "[LocationBuildingItem.GetBuilding]"
					tooltipwidget = {
						using = Building_tooltip
					}
				}
				card_header_button_04 = {
					size = { 100% 100% }
					ignore_layout = yes
					visible = "[Or(Not(LocationBuildingItem.IsPlayerBuilding), Building.GetType.OnlyEstatesCanBuild)]"
					enabled = no
					datacontext = "[LocationBuildingItem.GetBuilding]"
					tooltipwidget = {
						using = Building_tooltip
					}
				}
				widget = {
					size = { 100% 100% }
					visible = "[And3(LocationBuildingItem.GetBuilding.GetType.IsProducing, LocationBuildingItem.IsPlayerBuilding, Not(LocationBuildingItem.GetBuilding.GetType.OnlyEstatesCanBuild))]"
					card_header_button_04 = {
						size = { 100% 100% }
						ignore_layout = yes
						datacontext_from_model = { datamodel = "[LocationBuildingItem.GetBuilding.GetProductionMethods]" index = 0 }
						datacontext = "[LocationBuildingItem.GetBuilding]"

						action_tooltip = {
							click_type = left
							click_mode = single
							title = "OPEN_PROD_METHOD_BUILDING_ITEM_LOCATION"
							enabled = "[LocationBuildingItem.IsPlayerBuilding]"
							on_action = "[LocationBuildingItem.OpenBuildingView]"
						}
	
						action_tooltip = {
							click_type = right
							click_mode = single
							title = "BUILD_BUILDING_FROM_LOCATION"
							on_action = "[SelectLocationToBuildDefault(LocationBuildingItem.GetBuilding.GetType)]"
						}
						
						tooltipwidget = {
							using = Building_tooltip
						}
					}
				}

				# icon piechart
				widget = {
					block "circle_size" {
						parentanchor = center
						widgetanchor = hcenter|bottom
						position = {0 2}
						size = {77% 77%}
					}
					# ELF DESTINY HERE!
					icon = {
						# visible = "[LocationBuildingItem.IsBuildingForPopType(PopType.Self)]"
						# visible = "[And(Not(LocationBuildingItem.IsConstruction), LocationBuildingItem.IsBuildingForPopType(PopType.Self))]"
						visible = "[And(Not(LocationBuildingItem.IsConstruction), Not(LocationBuildingItem.IsBuildingForPopType(GetPopTypeByName('calaquendi').Self)) )]"
						size = { 80% 80% }
						parentanchor = center
						position = { 0 -1}
						texture = "[GetBuildingIcon(LocationBuildingItem.GetBuilding.GetType)]"
						glow = {
							name = "drop_shadow"
							glow_radius = 2
							color = {0.0 0.0 0.0 1.0}
							alpha = 0.6
						}
					}
					icon = {
						# visible = "[LocationBuildingItem.IsBuildingForPopType(PopType.Self)]"
						# visible = "[And(Not(LocationBuildingItem.IsConstruction), LocationBuildingItem.IsBuildingForPopType(PopType.Self))]"
						visible = "[And(Not(LocationBuildingItem.IsConstruction), LocationBuildingItem.IsBuildingForPopType(GetPopTypeByName('calaquendi').Self) )]"
						size = { 80% 80% }
						parentanchor = center
						position = { 0 -1}
						texture = "[GetBuildingIcon(LocationBuildingItem.GetBuilding.GetType)]"
						# glow = {
						# 	name = "drop_shadow"
						# 	glow_radius = 2
						# 	color = {0.0 0.0 0.0 1.0}
						# 	alpha = 0.6
						# }
						glow = {
							name = "glowing"
							glow_radius = 3.5
							color = { 0.9 0.9 0.6 1 }
							alpha = 0.4
						}
						using = Animation_Glow_Pulse
					}
					# ELF DESTINY ENDS
					piechart = {
						visible = "[LocationBuildingItem.IsConstruction]"
						parentanchor = center
						size = { 85% 85% }
						using = piechart_angles
						datacontext = "[LocationBuildingItem.GetConstruction]"
						tooltipwidget = {
							using = Construction_tooltip
						}
	
						icon = {
							texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
							size = { 97% 97% }
							parentanchor = center
							color = { 0 0 0 1 }
						}
	
						pieslice_no_highlight = {
							texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
							value = "[LocationBuildingItem.GetConstruction.GetProgress]"
							color = { 0.01 0.6 0.9 1 }
							alpha = 0.8
						}
	
						pieslice_no_highlight = {
							texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
							value = "[Subtract_float('(float)100.0', LocationBuildingItem.GetConstruction.GetProgress)]"
							color = { 0.0 0.1 0.1 1 }
							alpha = 0.8
						}
	
						icon = {
							size = { 17 17 }
							parentanchor = center
							texture = "[GetBuildingIcon(LocationBuildingItem.GetBuilding.GetType)]"
						}
					}

					icon = {
						parentanchor = bottom|left
						using = warning_icon_texture
						size = { 12 12 }
						position = { 0 -2 }
						visible = "[LocationBuildingItem.IsLackingInput]"
						datacontext = "[LocationBuildingItem.GetBuilding]"
						using = bg_circle
					}
					
					icon = {
						parentanchor = bottom|left
						texture = "gfx/interface/icons/alerts_icons/unprofitable.dds"
						size = { 12 12 }
						position = { 0 -2 }
						visible = "[And3(
							LessThan_CFixedPoint(Building.GetProfit, '(CFixedPoint)0'), 
							Not(Building.IsSubsidized),
							Not(LocationBuildingItem.IsLackingInput)
						)]"
						datacontext = "[LocationBuildingItem.GetBuilding]"
						using = bg_circle
					}		

					icon = {
						parentanchor = bottom|left
						texture = "gfx/interface/icons/flat_icons/lock.dds"
						modify_texture = {
							using = color_yellow_texture
							alpha = 1.4
						}
						modify_texture = {
							using = color_new_gold_texture
							alpha = 0.7
						}
						modify_texture = {
							using = color_black_texture
							blend_mode = multiply
							alpha = 0.6
						}
						size = { 12 12 }
						position = { 0 -2 }
						visible = "[Not(Building.IsOpen)]"
						datacontext = "[LocationBuildingItem.GetBuilding]"
						using = bg_circle
					}
					
					using = bg_circle_tile_shadow
					background = {
						texture = "gfx/interface/component_tiles/hud_corners/circle_background.dds"
						texture_density = 2
						modify_texture = {
							using = color_dark_blue_texture
							blend_mode = multiply
						}
						modify_texture = {
							color = "[LocationBuildingItem.GetBuilding.GetType.GetPopType.GetColor]"
							# blend_mode = multiply
							alpha = 0.8
						}
					}
					background = {
						texture = "gfx/interface/component_tiles/hud_corners/circle_frame.dds"
						
						modify_texture = {
							using = color_new_gold_texture
						}
						modify_texture = {
							using = overlay_stone_texture
							blend_mode = overlay
							alpha = 0.3
						}
						modify_texture = {
							using = overlay_window_texture
							blend_mode = overlay
							alpha = 0.3
						}
					}
				}
			}
				
			# plus minus
			widget = {
				layoutpolicy_horizontal = expanding
				block "square_icon_out_size_minus" {
					size = { -1 12 }
				}
				hbox = {
					spacing = -1
					flag_estate_building_card = {
						spacing = -1
						datacontext = "[LocationBuildingItem.GetBuilding.GetType]"
						datacontext = "[LocationBuildingItem.GetBuilding]"
						blockoverride "flag_estate_building_card_extra"{
							button_square_minus = {
								layoutpolicy_horizontal = expanding
								block "square_icon_out_size_minus" {
									size = { -1 12 }
								}
								datacontext = "[LocationBuildingItem.GetBuilding]"
								enabled = "[Or(And(Not(LocationBuildingItem.IsBuildingUnderConstruction), LocationBuildingItem.CanDestroy), And(LocationBuildingItem.IsBuildingUnderConstruction, LocationBuildingItem.CanDequeue))]"
								action_tooltip = {
									click_mode = confirm
									click_type = left
									datacontext = "[Building.GetType]"
									title = "L_DESTROY_BUILDING_ACTION"
									visible = "[Not(LocationBuildingItem.IsBuildingUnderConstruction)]"
									enabled = "[LocationBuildingItem.CanDestroy]"
									description = "[LocationBuildingItem.CanDestroyDesc]"
									on_action = "[LocationBuildingItem.Destroy]"
									on_action = "[PlayAudioEffect('UI_action_building_destroy')]"
								}
			
								action_tooltip = {
									click_mode = single
									click_type = left
									title = "DEQUEUE_BUILDING_ACTION"
									visible = "[LocationBuildingItem.IsBuildingUnderConstruction]"
									enabled = "[LocationBuildingItem.CanDequeue]"
									description = "[LocationBuildingItem.CanDequeueDesc]"
									on_action = "[LocationBuildingItem.Dequeue]"
								}
								tooltipwidget = {
									using = destroy_building_in_location_tt
								}
								blockoverride "square_icon_size" {
									size = {10 10}
								}
							}
						}
						blockoverride "flag_estate_building_card_flag_size" {
							block "tooltip_flag_estate_building_card_flag_size" {
								size = {19 12}
							}
						}
						blockoverride "flag_estate_building_card_estate_widget_size" {
							block "square_icon_out_size_minus" {
								size = { -1 12 }
							}
						}
						blockoverride "flag_estate_building_card_estate_icon_size" {
							block "tooltip_flag_estate_building_card_estate_icon_size" {
								size = { 13 13 }
							}
						}
					}
	
					button_square_plus = {
						layoutpolicy_horizontal = expanding
						block "square_icon_out_size_plus" {
							size = { -1 12 }
						}
						blockoverride "square_icon_size" {
							size = {10 10}
						}
						visible = "[And3(Not(LocationBuildingItem.GetBuilding.CanPlayerUpgrade), Not(LocationBuildingItem.GetBuilding.GetType.IsForeign), Not(Building.GetType.OnlyEstatesCanBuild))]"
						datacontext = "[LocationBuildingItem.GetBuilding]"
						datacontext = "[LocationBuildingItem.GetBuilding.GetType]"
						datacontext = "[LocationBuildingItem.GetBuilding.GetLocation]"
						enabled = "[LocationBuildingItem.CanExpandBuilding]"
						action_tooltip = {
							click_mode = single
							click_type = left
							click_modifier = default
							title = "CONSTRUCT_BUILDING_BUTTON"
							description = "[LocationBuildingItem.GetExpandBuildingInfo]"
							enabled = "[LocationBuildingItem.CanExpandBuilding]"
	
							on_action = "[LocationBuildingItem.ExpandBuilding]"
						}
						action_tooltip = {
							click_type = left
							click_mode = single
							click_modifier = ctrl
	
							title = "BUILDING_IN_LOCATION_ACTION_CTRL"
							description = "[LocationBuildingItem.GetExpandBuildingInfo]"
							enabled = "[LocationBuildingItem.CanExpandBuilding]"
	
							on_action = "[ExpandBuildingCtrl(LocationBuildingItem.GetBuilding.Self)]"
						}
	
						action_tooltip = {
							click_type = left
							click_mode = single
							click_modifier = shift
	
							title = "BUILDING_IN_LOCATION_ACTION_SHIFT"
							description = "[LocationBuildingItem.GetExpandBuildingInfo]"
							enabled = "[LocationBuildingItem.CanExpandBuilding]"
	
							on_action = "[ExpandBuildingShift(LocationBuildingItem.GetBuilding.Self)]"
						}
						tooltipwidget = { using = construct_building_in_location_tt }
					}

					button_square_plus = {
						layoutpolicy_horizontal = expanding
						size = { -1 12 }
						blockoverride "square_icon_size" {
							size = {10 10}
						}
						blockoverride "plusminus_icon" {
							texture = "gfx/interface/buttons/flats/upgrade_button2.dds"
						}
						visible = "[And3(LocationBuildingItem.GetBuilding.CanPlayerUpgrade, Not(LocationBuildingItem.GetBuilding.GetType.IsForeign), Not(LocationBuildingItem.GetBuilding.GetType.OnlyEstatesCanBuild))]"
						datacontext = "[LocationBuildingItem.GetBuilding.GetType.GetNextReplaced(Player.Self)]"
						datacontext = "[LocationBuildingItem.GetBuilding.GetLocation]"
						enabled = "[CanUpgradeToBuilding(BuildingType.Self, Location.Self)]"
						action_tooltip = {
							click_mode = single
							click_type = left
							click_modifier = default
							title = "UPGRADE_BUILDING_ACTION"
							enabled = "[CanUpgradeToBuilding(BuildingType.Self, Location.Self)]"
							description = "[CanUpgradeToBuildingInfo(BuildingType.Self, Location.Self)]"
							cost = "[GetBuildOrExpandBuildingCostValue(BuildingType.Self, Location.Self)]"
							on_action = "[UpgradeBuildingDefault(BuildingType.Self, Location.Self)]"
						}

						action_tooltip = {
							click_type = left
							click_mode = single
							click_modifier = ctrl

							title = "UPGRADE_BUILDING_ACTION_CTRL"
							cost = "[GetBuildOrExpandBuildingCostValue(BuildingType.Self, Location.Self)]"
							description = "[CanUpgradeToBuildingInfo(BuildingType.Self, Location.Self)]"
							on_action = "[UpgradeBuildingCtrl(BuildingType.Self, Location.Self)]"
							enabled = "[CanUpgradeToBuilding(BuildingType.Self, Location.Self)]"
						}

						action_tooltip = {
							click_type = left
							click_mode = single
							click_modifier = shift

							title = "UPGRADE_BUILDING_ACTION_SHIFT"
							cost = "[GetBuildOrExpandBuildingCostValue(BuildingType.Self, Location.Self)]"
							description = "[CanUpgradeToBuildingInfo(BuildingType.Self, Location.Self)]"
							on_action = "[UpgradeBuildingShift(BuildingType.Self, Location.Self)]"
							enabled = "[CanUpgradeToBuilding(BuildingType.Self, Location.Self)]"
						}

						tooltipwidget = {
							using = construct_building_in_location_tt
						}
					}
				}
			}
		}
	}

	type character_titles = vbox {
		layoutpolicy_horizontal = expanding
		block "character_titles_datacontext" {}
		### Religion
		hbox =	{
			layoutpolicy_horizontal = expanding
			block "country_header_orientation" {}

			block "country_header_religion" {
				character_religion = {}
			}
			
			expand = {}
		}
		### Extra Titles
		hbox =	{
			layoutpolicy_horizontal = expanding
			block "country_header_orientation" {}

			block "extra_titles" {
				visible = no
			}
			expand = {}
		}
		spacing = 1
		### ruler title
		hbox = {
			layoutpolicy_horizontal = expanding
			spacing = 10
			block "country_header_orientation" {}
			block "character_title_left" {}
			hbox = {
				layoutpolicy_horizontal = expanding
				block "character_title" {}
			}
		}

		hbox = {
			layoutpolicy_horizontal = expanding

			hbox = {
				# layoutpolicy_horizontal = expanding
				block "country_header_names_visible" {}
				block "country_header_orientation" {}
				block "character_name_extra" {}
				parentanchor = vcenter
				# margin = {0 2}
				margin_left = 14 # Needed for IOS with side window art
				widget = {
					size = {32 32}

					header_button_left = {
						size = { 100% 100% }
						blockoverride "button_icon_stretch_sprite" {}
						blockoverride "header_button_frame_inner" {visible = no}
						blockoverride "header_button_icon_size" { size = { 30 30 } }
						blockoverride "header_button_text_layout" {}

						blockoverride "icon_texture" {
							texture = "gfx/interface/buttons/flats/history.dds"
							texture_density = 2
						}

						onclick = "[ShowRulingHistoryForInternationalOrganization(InternationalOrganizationsView.GetInternationalOrganization.Self)]"
						tooltipwidget = {
							LeftClickButtonTooltip = {
								blockoverride "onclick_text" { 
									text = "RULING_HISTORY_INTERNATIONAL_ORGANIZATION_SIDEMENU"
								}
							}
						}
					}
					visible = "[And(And(Not(IsLateralViewOpened('government')), Not(IsLateralViewOpened('foreign_country'))), InternationalOrganizationsView.ShouldShowRulingHistory)]"
				}

				# Elf Destiny Race
				hbox = {
					datacontext = "[Character.MakeScope.GetVariable('character_race')]"

					widget = {
						size = { 40 40 }
						
						icon = {
							visible = "[Character.MakeScope.GetVariable('character_race').IsSet]"

							size = { 80% 80% }
							# using = trait_item
							parentanchor = center

							# texture = "gfx/interface/icons/modifiers/elf_tier_3.dds"
							# texture = "[Concatenate(Concatenate('gfx/interface/icons/genetic_traits/', Scope.GetFlagName), '.dds')]"
							# texture = "[TimedModifier.GetModifier.GetIcon]"
							texture = "[GetTraitIcon(Scope.Trait.Self)]"

							# GetModifier(

							glow = {
								# visible = "[EqualTo_string(Trait.GetFlavor.GetName, Localize('elf_bloodline'))]"
								# visible = "[EqualTo_string(Trait.GetFlavor.GetName, 'elf_bloodline')]"

								name = "glowing"
								glow_radius = 2.5
								color = { 0.9 0.9 0.6 1 }
								alpha = 0.4
							}
							using = Animation_Glow_Pulse


							tooltipwidget = {
								ContextualTooltipType = {
									blockoverride "title_text" {
										text = "[Scope.Trait.GetNameWithNoTooltip]"
									}
									
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "[GetTraitIcon(Scope.Trait.Self)]"

											glow = {
												# visible = "[EqualTo_string(Trait.GetFlavor.GetName, Localize('elf_bloodline'))]"
												# visible = "[EqualTo_string(Trait.GetFlavor.GetName, 'elf_bloodline')]"

												name = "glowing"
												glow_radius = 2.5
												color = { 0.9 0.9 0.6 1 }
												alpha = 0.4
											}
											using = Animation_Glow_Pulse
										}
									}

									blockoverride "concept_link" {
										text = racial_trait
										# text = "[Scope.Trait.GetCategoryTag]"
									}

									blockoverride "tooltip_content" {
										TooltipStringPairList = {
											datacontext = "[StringToStringPairList(Scope.Trait.GetTooltip)]"
										}

										TooltipFlavorTextBlock = {
											blockoverride "text" {
												text = "[Scope.Trait.GetDesc]"
											}
										}
									}
								}
							}
						}

						icon = {
							visible = "[Not(Character.MakeScope.GetVariable('character_race').IsSet)]"

							size = { 80% 80% }
							# using = trait_item
							parentanchor = center

							# texture = "gfx/interface/icons/traits/human.dds"
							# texture = "[Concatenate(Concatenate('gfx/interface/icons/genetic_traits/', Scope.GetFlagName), '.dds')]"
							# texture = "[TimedModifier.GetModifier.GetIcon]"
							texture = "[GetTraitIcon(GetGlobalVariable('human_trait').Trait.Self)]"

							# GetModifier(

							glow = {
								# visible = "[EqualTo_string(Trait.GetFlavor.GetName, Localize('elf_bloodline'))]"
								# visible = "[EqualTo_string(Trait.GetFlavor.GetName, 'elf_bloodline')]"

								name = "glowing"
								glow_radius = 2.5
								color = { 0.9 0.9 0.6 1 }
								alpha = 0.4
							}
							# using = Animation_Glow_Pulse


							tooltipwidget = {
								ContextualTooltipType = {
									blockoverride "title_text" {
										text = "[GetGlobalVariable('human_trait').Trait.GetNameWithNoTooltip]"
									}
									
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "[GetTraitIcon(GetGlobalVariable('human_trait').Trait.Self)]"

											glow = {
												name = "glowing"
												glow_radius = 2.5
												color = { 0.9 0.9 0.6 1 }
												alpha = 0.4
											}
											using = Animation_Glow_Pulse
										}
									}

									blockoverride "concept_link" {
										text = racial_trait
										# text = "[Scope.Trait.GetCategoryTag]"
									}

									blockoverride "tooltip_content" {
										TooltipStringPairList = {
											datacontext = "[StringToStringPairList(GetGlobalVariable('human_trait').Trait.GetTooltip)]"
										}

										TooltipFlavorTextBlock = {
											blockoverride "text" {
												text = "[GetGlobalVariable('human_trait').Trait.GetDesc]"
											}
										}
									}
								}
							}
						}

					}
				}
				block "country_header_character_name" {
					margin = {2 0}
					character_label_name = {
						margin_left = 0
						margin_right = 10
					}
				}

				# expand = {}
			}
				# Elf Destiny Race traits
			fixedgridbox = {
				
				datamodel = "[Character.MakeScope.GetList('genetic_traits')]"
				flipdirection = yes

				addcolumn = 40
				addrow = 40
				setitemsizefromcell = yes

				datamodel_wrap = 3

				item = {
					widget = {
						size = { 40 40 }

						icon = {
							size = { 100% 100% }
							parentanchor = center

							texture = "[GetTraitIcon(Scope.Trait.Self)]"


							glow = {
								# visible = "[EqualTo_string(Trait.GetFlavor.GetName, Localize('elf_bloodline'))]"
								# visible = "[EqualTo_string(Trait.GetFlavor.GetName, 'elf_bloodline')]"

								name = "glowing"
								glow_radius = 2.5
								color = { 0.9 0.9 0.6 1 }
								alpha = 0.4
							}
							using = Animation_Glow_Pulse


							tooltipwidget = {
								ContextualTooltipType = {
									blockoverride "title_text" {
										text = "[Scope.Trait.GetNameWithNoTooltip]"
									}
									
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "[GetTraitIcon(Scope.Trait.Self)]"

											glow = {
												# visible = "[EqualTo_string(Trait.GetFlavor.GetName, Localize('elf_bloodline'))]"
												# visible = "[EqualTo_string(Trait.GetFlavor.GetName, 'elf_bloodline')]"

												name = "glowing"
												glow_radius = 2.5
												color = { 0.9 0.9 0.6 1 }
												alpha = 0.4
											}
											using = Animation_Glow_Pulse
										}
									}

									blockoverride "concept_link" {
										text = genetic_trait
										# text = "[Scope.Trait.GetCategoryTag]"
									}

									blockoverride "tooltip_content" {
										TooltipStringPairList = {
											datacontext = "[StringToStringPairList(Scope.Trait.GetTooltip)]"
										}

										TooltipFlavorTextBlock = {
											blockoverride "text" {
												text = "[Scope.Trait.GetDesc]"
											}
										}
									}
								}
							}
						}
					}
				}
			}
			expand = {}

		}


		### Abilities and dynasty
		block "abilities_widget" {
			widget = {
				layoutpolicy_horizontal = expanding
				block "abilities_box_size" {
					size = { -1 40 }
				}

				block "character_dynasty" {
					hbox = {
						layoutpolicy_horizontal = expanding
						block "country_header_orientation" {}
						block "country_header_dynasty" {
							character_label_dynasty = {}
						}
						expand = {}
					}
				}

				block "abilities_box" {}

				block "abilities_box_bg" {
					using = bg_paper_card
					using = bg_cabinet_card_frame
				}
				
				hbox = {
					allow_outside = yes
					# using = bg_overview_container_frame_02
					# blockoverride "overview_container_02_extra" {
					# 	margin = {4 3}
					# } 
					block "country_header_orientation" {}
					## HISTORY BUTTON
					block "abilities" {}
				}
				block "abilities_parent" {}
			}
		}
	}
}